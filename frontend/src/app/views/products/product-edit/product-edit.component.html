<div class="card">
    <div class="card-header">
        <h3>Edit Product</h3>
    </div>
    <div class="card-body">
        <form [formGroup]="form" (ngSubmit)="submit()">
            <!-- Product Name -->
            <div class="mb-3">
                <label class="form-label">Product Name</label>
                <input type="text" class="form-control" formControlName="name" />
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" formControlName="description" rows="3"></textarea>
            </div>

            <!-- Category -->
            <div class="mb-3">
                <label class="form-label">Category</label>
                <select class="form-select" formControlName="category_id" (change)="onCategoryChange()">
                    <option value="">-- Select Category --</option>
                    <option *ngFor="let category of categories" [value]="category._id">{{ category.name }}</option>
                </select>
            </div>

            <!-- Sub Category -->
            <div class="mb-3">
                <label class="form-label">Sub Category</label>
                <select class="form-select" formControlName="sub_category_id">
                    <option value="">-- Select Subcategory --</option>
                    <option *ngFor="let sub of subcategories" [value]="sub._id">{{ sub.name }}</option>
                </select>
            </div>



            <!-- Unit -->
            <div class="mb-3">
                <label class="form-label">Unit</label>
                <select class="form-select" formControlName="unit">
                    <option value="piece">Piece</option>
                    <option value="liter">Liter</option>
                    <option value="kg">Kilogram</option>
                </select>
            </div>

            <!-- Unit Price -->
            <div class="mb-3">
                <label class="form-label">Unit Price</label>
                <input type="number" (wheel)="disableScroll($event)" (keydown)="disableArrowKeys($event)"
                    class="form-control" formControlName="unit_price" />
            </div>

            <!-- Tax Model -->
            <div class="mb-3">
                <label class="form-label">Tax Model</label>
                <select class="form-select" formControlName="tax_model">
                    <option value="include">Include</option>
                    <option value="exclude">Exclude</option>
                </select>
            </div>

            <!-- Tax -->
            <div class="mb-3">
                <label class="form-label">Tax (%)</label>
                <input type="number" class="form-control" formControlName="tax" />
            </div>

            <!-- Discount Type -->
            <div class="mb-3">
                <label class="form-label">Discount Type</label>
                <select class="form-select" formControlName="discount_type">
                    <option value="flat">Flat</option>
                    <option value="percent">Percentage</option>
                </select>
            </div>

            <!-- Discount -->
            <div class="mb-3">
                <label class="form-label">Discount</label>
                <input type="number" (wheel)="disableScroll($event)" (keydown)="disableArrowKeys($event)"
                    class="form-control" formControlName="discount" />
            </div>

            <!-- Current Stock -->
            <div class="mb-3">
                <label class="form-label">Current Stock</label>
                <input type="number" (wheel)="disableScroll($event)" (keydown)="disableArrowKeys($event)"
                    class="form-control" formControlName="current_stock" />
            </div>

            <!-- Minimum Quantity Purchase -->
            <div class="mb-3">
                <label class="form-label">Minimum Quantity Purchase</label>
                <input type="number" (wheel)="disableScroll($event)" (keydown)="disableArrowKeys($event)"
                    class="form-control" formControlName="min_qty" />
            </div>

            <!-- Thumbnail -->
            <div class="mb-3" style="position: relative;">
                <label class="form-label">Thumbnail</label>
                <input type="file" class="form-control" (change)="onImageSelected($event)" [disabled]="isUploading" />
                <div *ngIf="imagePreview" class="mt-2" style="position: relative; display: inline-block;">
                    <img [src]="imagePreview" alt="Thumbnail" style="max-height: 150px; border-radius: 4px;" />
                    <button type="button" class="btn btn-sm btn-danger" (click)="removeThumbnail()"
                        title="Remove Thumbnail" style="
              position: absolute;
              top: 2px;
              right: 2px;
              padding: 0 8px;
              line-height: 1;
              font-weight: bold;
              border-radius: 50%;
              font-size: 18px;
              cursor: pointer;
            ">
                        &times;
                    </button>
                </div>
                <div class="invalid-feedback d-block" *ngIf="uploadError">
                    {{ uploadError }}
                </div>
            </div>

            <!-- Photos Upload -->
            <div class="mb-3">
                <label class="form-label">Photos</label>
                <div *ngFor="let input of photoInputs; let i = index" class="mb-2">
                    <input type="file" class="form-control" (change)="onSinglePhotoSelected($event, i)" />
                </div>
                <div class="mt-2 d-flex flex-wrap gap-2" *ngIf="photoPreviews?.length" style="position: relative;">
                    <div *ngFor="let img of photoPreviews; let idx = index"
                        style="position: relative; display: inline-block;">
                        <img [src]="img" alt="Photo" style="max-height: 100px; border-radius: 4px;" />
                        <button type="button" class="btn btn-sm btn-danger" (click)="removePhoto(idx)"
                            title="Remove Photo" style="
                position: absolute;
                top: 2px;
                right: 2px;
                padding: 0 6px;
                line-height: 1;
                font-weight: bold;
                border-radius: 50%;
                font-size: 14px;
                cursor: pointer;
              ">
                            &times;
                        </button>
                    </div>
                </div>
                <button *ngIf="photoPreviews?.length" type="button" class="btn btn-danger mt-2"
                    (click)="removeAllPhotos()">
                    Remove All Photos
                </button>
            </div>

            <!-- Status -->
            <div class="mb-3">
                <label class="form-label">Status</label>
                <select class="form-select" formControlName="status">
                    <option [ngValue]="1">Active</option>
                    <option [ngValue]="0">Inactive</option>
                </select>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary"
                [disabled]="form.invalid || isSubmitting || isUploading || isPhotosUploading">
                {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
            </button>

            <!-- Cancel -->
            <button type="button" class="btn btn-secondary ms-2" (click)="onCancel()">
                Cancel
            </button>

        </form>
    </div>
</div>