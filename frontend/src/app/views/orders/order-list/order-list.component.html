<div class="container mt-4">
  <h2>Orders</h2>

  <!-- Search Input -->
  <div class="mb-3">
    <input
      type="text"
      class="form-control"
      placeholder="Search by customer name or mobile"
      [(ngModel)]="searchText"
      (ngModelChange)="onSearchChange()"
    />
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center">Loading orders...</div>

  <!-- Orders Table -->
  <div class="table-responsive" *ngIf="!isLoading && orders.length > 0">
    <table class="table table-bordered align-middle text-nowrap">
      <thead class="table-light">
        <tr>
          <th>SL</th>
          <th>Order ID</th>
          <th>Order Date</th>
          <th>Customer Info</th>
          <th>Store</th>
          <th>Total Amount</th>
          <th>Order Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders; let i = index">
          <!-- SL -->
          <td>{{ (currentPage - 1) * limit + i + 1 }}</td>

          <!-- Order ID -->
          <td>
            <strong>{{ order._id || "N/A" }}</strong>
          </td>

          <!-- Order Date -->
          <td>{{ order.createdAt | date : "dd MMM yyyy, hh:mm a" }}</td>

          <!-- Customer Info -->
          <td>
            <div class="fw-bold">
              {{ order.customer_id?.name || "Guest User" }}
            </div>
            <div>{{ order.customer_id?.mobile || "N/A" }}</div>
          </td>

          <!-- Store Info -->
          <td>
            <ng-container *ngIf="order?.seller_id; else adminStore">
              <div class="fw-semibold">
                {{ order.seller_id?.shop_name || "N/A" }}
              </div>
              <div class="text-muted small">
                {{ order.seller_id?.mobile || "N/A" }}
              </div>
            </ng-container>
            <ng-template #adminStore>
              <div class="fw-semibold">Admin</div>
            </ng-template>
          </td>

          <!-- Total Amount + Payment Status -->
          <td>
            â‚¹{{ order.total_price | number : "1.2-2" }}
            <div
              [ngClass]="{
                'text-danger': order.payment_status === 'Unpaid',
                'text-success': order.payment_status === 'Paid'
              }"
              class="small fw-semibold"
            >
              {{ order.payment_status }}
            </div>
          </td>

          <!-- Order Status -->
          <td>
            <span
              class="badge px-3 py-1"
              [ngClass]="{
                'bg-info text-dark': order.status === 'Pending',
                'bg-success': order.status === 'Delivered',
                'bg-warning text-dark': order.status === 'Processing',
                'bg-danger': order.status === 'Cancelled'
              }"
            >
              {{ order.status }}
            </span>
          </td>

          <!-- Action -->
          <td>
            <a
              [routerLink]="['/orders', order._id]"
              class="btn btn-sm btn-primary"
            >
              View
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Orders Message -->
  <div
    *ngIf="!isLoading && orders.length === 0"
    class="text-center text-muted mt-3"
  >
    No orders found.
  </div>

  <!-- Pagination Controls -->
  <nav *ngIf="totalPages > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button
          class="page-link"
          (click)="changePage(currentPage - 1)"
          [disabled]="currentPage === 1"
        >
          Previous
        </button>
      </li>

      <li
        class="page-item"
        *ngFor="let page of [].constructor(totalPages); let idx = index"
        [class.active]="currentPage === idx + 1"
      >
        <button class="page-link" (click)="changePage(idx + 1)">
          {{ idx + 1 }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button
          class="page-link"
          (click)="changePage(currentPage + 1)"
          [disabled]="currentPage === totalPages"
        >
          Next
        </button>
      </li>
    </ul>
  </nav>
</div>
